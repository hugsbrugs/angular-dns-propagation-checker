angular.module("angular-dns-propagation-checker",[]),angular.module("angular-dns-propagation-checker").provider("dnsChecker",[function(){var e="/get_nodes.php",n="/get_node.php";this.$get=[function(){return{apiListDns:e,apiGetDns:n}}],this.setApiListDns=function(n){e=n},this.setApiGetDns=function(e){n=e}}]),angular.module("angular-dns-propagation-checker").controller("DnsController",["$rootScope","$scope","$log","DnsService","UrlService","$interval","$timeout","$compile","$sce",function(n,t,r,a,s,o,c,l,i){t.nodes=null,t.domain={url:"",record:"a",expected:""},t.records=["a","cname","mx","ns","spf","txt"],t.check={total:0,current:0,success:0,warning:0,danger:0},t.dns_check_running=!1,t.get_nodes=function(){a.get_nodes().then(function(e){t.nodes=e.data.nodes,t.get_url()})["catch"](function(e){alert("error"+JSON.stringify(e))})},t.get_url=function(){var e=s.get_url();null!==e.url&&e.url.length>0&&(t.domain.url=e.url),null!==e.record&&e.record.length>0&&t.records.indexOf(e.record)>-1&&(t.domain.record=e.record),null!==e.expected&&e.expected.length>0&&(t.domain.expected=e.expected),t.domain.url.length>0&&t.domain.record.length>0&&t.check_all_dns()},t.reset_check_dns=function(){angular.forEach(t.nodes,function(e){e.status=null,e.result=null,e.results=null,e.ttl=null}),t.check={total:0,current:0,success:0,warning:0,danger:0}},t.check_all_dns=function(){if(t.dns_check_running)return event.preventDefault(),!1;t.reset_check_dns(),s.set_url(t.domain),t.dns_check_running=!0,t.check.total=t.nodes.length,t.check.current=0;var e=0;o(function(){t.check_one_dns(t.nodes[e]),e++},1e3,t.nodes.length)},t.check_one_dns=function(e){a.get_node(e,t.domain.url,t.domain.record).then(function(n){t.process_node_success(e,n.data)})["catch"](function(n){t.process_node_error(e,n)})["finally"](function(e){t.check.current++,t.check.current===t.nodes.length&&(t.dns_check_running=!1)})},t.process_node_error=function(e,n){r.log("process_node_error",n),e.result=i.trustAsHtml("Request timed out. <span ng-click=\"view_raw('"+e.name+"','"+t.domain.url+"','"+t.domain.record+"')\">View Raw</span>"),e.status="warning",t.check.warning++},t.process_node_success=function(e,n){if("undefined"!=typeof n.code)e.result=n.code+": "+n.message,e.status="warning",t.check.warning++;else if(n.answer)if(n.answer){var r=[];n.answer.forEach(function(e){r.push({res:e.rdata,ttl:e.ttl})}),e.result="OK",e.results=r,t.domain.expected?(angular.forEach(e.results,function(n){n.res.match(new RegExp("^"+t.domain.expected+"$","i"))?(n.status="success",e.status="success"):n.status="danger"}),"success"===e.status?t.check.success++:(e.status="danger",t.check.danger++)):t.check.success++}else e.result="Unknown response",e.status="warning",t.check.warning++;else e.result="No record",e.status="warning",t.check.warning++},t.view_raw=function(n,t,a){r.log("view_raw"),e.preventDefault();var s="http://www.dns-lg.com/"+n+"/"+t+"/"+a;angular.element(element).html('<iframe src="'+s+'"></iframe>')},t.get_nodes()}]),angular.module("angular-dns-propagation-checker").factory("DnsService",["$rootScope","$log","$http","$interval","$timeout","dnsChecker",function(e,n,t,r,a,s){return{get_nodes:function(){return t.get(s.apiListDns)},get_node:function(e,n,r){return t.get(s.apiGetDns+"?url="+encodeURIComponent("http://www.dns-lg.com/"+e.name+"/"+n+"/"+r),{timeout:15e3})}}}]).factory("UrlService",["$rootScope","$log","$http","$interval","$timeout",function(e,n,t,r,a){return{set_url:function(e){window.location.hash=this.serializeObj(e)},get_url:function(e,n,t){var r,n={url:null,record:null,expected:null},a=window.location.hash;return a&&(r=a.substring(1).split("&"),r.forEach(function(e){var t=e.split("=");"record"===t[0]?n.record=t[1]:n[t[0]]=decodeURIComponent(t[1])})),n},serializeObj:function(e){var n=[];for(var t in e)n.push(encodeURIComponent(t)+"="+encodeURIComponent(e[t]));return n.join("&")}}}]),angular.module("angular-dns-propagation-checker").directive("dnsChecker",[function(){return{restrict:"E",replace:!1,template:'<div class="row"><div class="col-md-4" id="toolbar"><div class="card"><div class="card-header"><h3 class="card-title">Options</h3></div><div class="card-body"><form name="DnsForm" ng-submit="check_all_dns()" novalidate><label for="domain">Domain</label><div class="input-group"><div class="input-group-prepend"><span class="input-group-text">http://</span></div><input type="text" class="form-control" id="domain" name="domain" ng-model="domain.url" required></div><div class="input-group"><label for="record-type">Record Type</label><div class="btn-group" role="group"><label class="btn btn-sm btn-secondary" ng-model="domain.record" uib-btn-radio="\'a\'">A</label> <label class="btn btn-sm btn-secondary" ng-model="domain.record" uib-btn-radio="\'cname\'">CNAME</label> <label class="btn btn-sm btn-secondary" ng-model="domain.record" uib-btn-radio="\'mx\'">MX</label> <label class="btn btn-sm btn-secondary" ng-model="domain.record" uib-btn-radio="\'ns\'">NS</label> <label class="btn btn-sm btn-secondary" ng-model="domain.record" uib-btn-radio="\'spf\'">SPF</label> <label class="btn btn-sm btn-secondary" ng-model="domain.record" uib-btn-radio="\'txt\'">TXT</label></div></div><div class="form-group"><label for="domain">Expected Value</label> <small>optional regex</small> <input type="text" ng-model="domain.expected" class="form-control" id="expected" name="expected"></div><div class="form-group"><button class="btn btn-secondary float-right" type="submit" id="go" ng-disabled="DnsForm.$invalid || dns_check_running" data-loading-text="Running...">Go !</button></div></form></div></div><div class="card mt-3"><div class="card-body"><i class="fa fa-book"></i> <a href="http://www.dns-lg.com/" target="_blank">API Documentation</a><hr><i class="fa fa-github"></i> <a href="https://github.com/hugsbrugs/angularjs-dns-propagation-checker" title="Github Repository">Code on Github</a><hr><i class="fa fa-user-md"></i> <a href="https://hugo.maugey.fr" title="Webmaster AngularJS">Author</a></div></div></div><div class="col-md-8"><uib-progress ng-hide="check.total==0" max="check.total" value="check.current" striped="true" animate="true"><uib-bar value="check.success" type="success" striped="true"><i>{{((check.success/check.total)*100) | number:0}}%</i></uib-bar><uib-bar value="check.warning" type="warning" striped="true"><i>{{((check.warning/check.total)*100) | number:0}}%</i></uib-bar><uib-bar value="check.danger" type="danger" striped="true"><i>{{((check.danger/check.total)*100) | number:0}}%</i></uib-bar></uib-progress><div class="table-responsive"><table class="table table-sm"><thead><tr><th>Server</th><th>Result</th><th>TTL</th></tr></thead><tbody><tr ng-repeat="node in nodes track by $index" id="{{node.name}}" class="{{node.status}}"><td class="country"><span uib-tooltip="{{node.operator}}"><div class="flag flag-{{node.isocc}}"></div>{{node.country}}</span></td><td colspan="2" ng-if="node.result!=\'OK\'"><span ng-bind-html="node.result"></span></td><td colspan="2" ng-if="node.result==\'OK\'"><table class="table table-hover table-condensed table-hug"><tbody><tr ng-repeat="(key, value) in node.results track by $index"><td><span ng-show="value.status==\'success\'" class="text-success"><i class="fa fa-check"></i></span> <span ng-show="value.status==\'danger\'" class="text-danger"><i class="fa fa-times"></i></span></td><td>{{value.res}}</td><td width="100"><span uib-tooltip="{{value.ttl}} seconds">{{value.ttl | amDurationFormat : \'seconds\'}}</span></td></tr></tbody></table></td></tr></tbody></table></div></div></div>',controller:"DnsController"}}]);